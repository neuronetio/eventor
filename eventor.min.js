"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Eventor=function(){function copyArray(source,array){return array=source.slice()}function pushArray(source,array){var index=-1,length=source.length;array||(array=Array(length));for(var last=array.length;++index<length;)array[last]=source[index],last++;return array}function pushObjAsArray(source,array){array||(array=Array(source.length));var last=array.length;for(var item in source)array[last]=source[item],last++;return array}function Eventor(opts){function generateEventId(){return root.unique()}var root={};opts=opts||{};var sharedData={lastId:0};return opts._shared=sharedData,"undefined"!=typeof opts.promise?root.promise=opts.promise:root.promise=Promise,"undefined"==typeof opts.timeout&&(opts.timeout=6e4),root.timeout=opts.timeout,opts.root=root,root._useBeforeAll=new EventorBasic(opts),root._useBefore=new EventorBasic(opts),root._normal=new EventorBasic(opts),root._useAfter=new EventorBasic(opts),root._useAfterAll=new EventorBasic(opts),"undefined"==typeof opts.unique?root.unique=uid:root.unique=opts.unique,root.on=function(){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return root._normal.on.apply(root._normal,args)},root.removeListener=function(listenerId){if(listenerId=listenerId.toString(),Object.keys(root._normal._allListeners).indexOf(listenerId)>=0)return root._normal.removeListener.apply(root._normal,[listenerId]);if(Object.keys(root._useBefore._allListeners).indexOf(listenerId)>=0)return root._useBefore.removeListener.apply(root._useBefore,[listenerId]);if(Object.keys(root._useAfter._allListeners).indexOf(listenerId)>=0)return root._useAfter.removeListener.apply(root._useAfter,[listenerId]);if(Object.keys(root._useAfterAll._allListeners).indexOf(listenerId)>=0)return root._useAfterAll.removeListener.apply(root._useAfterAll,[listenerId]);var error=new Error("No listener found with specified id ["+listenerId+"]");throw error},root.useBefore=function(){for(var _len6=arguments.length,args=Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return root._useBefore.on.apply(root._useBefore,args)},root.useAfter=function(){for(var _len7=arguments.length,args=Array(_len7),_key7=0;_key7<_len7;_key7++)args[_key7]=arguments[_key7];return root._useAfter.on.apply(root._useAfter,args)},root.useBeforeAll=function(){for(var _len8=arguments.length,args=Array(_len8),_key8=0;_key8<_len8;_key8++)args[_key8]=arguments[_key8];return root._useBeforeAll.on.apply(root._useBeforeAll,args)},root.useAfterAll=function(){for(var _len9=arguments.length,args=Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return root._useAfterAll.on.apply(root._useAfterAll,args)},root.emit=function(){function normal(input){var useBeforeParsed=Object.assign({},useBeforeAllParsed);useBeforeParsed.data=input,useBeforeParsed.event={eventId:eventId,type:"emit",eventName:useBeforeParsed.eventName,nameSpace:useBeforeParsed.nameSpace,isUseBefore:!0,isUseAfter:!1,isUseBeforeAll:!1,isUseAfterAll:!1};var normalParsed=Object.assign({},useBeforeParsed);normalParsed.data=input,normalParsed.event={eventId:eventId,type:"emit",eventName:normalParsed.eventName,nameSpace:normalParsed.nameSpace,isUseBefore:!1,isUseAfter:!1,isUseBeforeAll:!1,isUseAfterAll:!1};var useAfterParsed=Object.assign({},useBeforeParsed);useAfterParsed.data=void 0,useAfterParsed.event={eventId:eventId,type:"emit",eventName:useAfterParsed.eventName,nameSpace:useAfterParsed.nameSpace,isUseBefore:!1,isUseAfter:!0,isUseBeforeAll:!1,isUseAfterAll:!1};var inlineOn={_before:root._useBefore,beforeParsed:useBeforeParsed,_after:root._useAfter,afterParsed:useAfterParsed},p=void 0;p=root._normal._emit(normalParsed,inlineOn);var afterAllListeners=void 0;return afterAllListeners="undefined"!=typeof nameSpace?root._useAfterAll.listeners(nameSpace,eventName):root._useAfterAll.listeners(eventName),afterAllListeners.length>0&&(p=p.then(function(results){var useAfterParsed=Object.assign({},useBeforeParsed);return useAfterParsed.data=results,useAfterParsed.event={eventId:eventId,type:"emit",eventName:useAfterParsed.eventName,nameSpace:useAfterParsed.nameSpace,isUseBefore:!1,isUseAfter:!1,isUseBeforeAll:!1,isUseAfterAll:!0},root._useAfterAll._cascade(useAfterParsed)})),p}for(var _len10=arguments.length,args=Array(_len10),_key10=0;_key10<_len10;_key10++)args[_key10]=arguments[_key10];var timeoutObj={arguments:args,type:"emit",error:new Error("timeout")},finished=setTimeout(function(){root.emit("timeout",timeoutObj)},root.timeout),useBeforeAllParsed=root._normal._parseArguments(args),eventName=useBeforeAllParsed.eventName,nameSpace=useBeforeAllParsed.nameSpace,eventId=generateEventId();useBeforeAllParsed.event={eventId:eventId,type:"emit",eventName:useBeforeAllParsed.eventName,nameSpace:useBeforeAllParsed.nameSpace,isUseBefore:!1,isUseAfter:!1,isUseBeforeAll:!0,isUseAfterAll:!1};var result=root._useBeforeAll._cascade(useBeforeAllParsed).then(normal).then(function(results){return clearTimeout(finished),results});return result},root.cascade=function(){function afterAll(input){var useAfterParsed=Object.assign({},useBeforeAllParsed);return useAfterParsed.data=input,useAfterParsed.event={eventId:eventId,type:"cascade",eventName:useAfterParsed.eventName,nameSpace:useAfterParsed.nameSpace,isUseBeforeAll:!1,isUseBefore:!1,isUseAfter:!1,isUseAfterAll:!0},root._useAfterAll._cascade(useAfterParsed)}for(var _len11=arguments.length,args=Array(_len11),_key11=0;_key11<_len11;_key11++)args[_key11]=arguments[_key11];var timeoutObj={arguments:args,type:"cascade",error:new Error("timeout")},finished=setTimeout(function(){root.emit("timeout",timeoutObj)},root.timeout),useBeforeAllParsed=root._normal._parseArguments(args),nameSpace=useBeforeAllParsed.nameSpace,eventName=useBeforeAllParsed.eventName,eventId=generateEventId();useBeforeAllParsed.event={eventId:eventId,type:"cascade",eventName:useBeforeAllParsed.eventName,nameSpace:useBeforeAllParsed.nameSpace,isUseBefore:!1,isUseAfter:!1,isUseBeforeAll:!0,isUseAfterAll:!1};var useBeforeParsed=Object.assign({},useBeforeAllParsed);useBeforeParsed.event={eventId:eventId,type:"cascade",eventName:useBeforeParsed.eventName,nameSpace:useBeforeParsed.nameSpace,isUseBefore:!0,isUseAfter:!1,isUseBeforeAll:!1,isUseAfterAll:!1};var normalParsed=Object.assign({},useBeforeAllParsed);normalParsed.event={eventId:eventId,type:"cascade",eventName:normalParsed.eventName,nameSpace:normalParsed.nameSpace,isUseBeforeAll:!1,isUseBefore:!1,isUseAfter:!1,isUseAfterAll:!1};var useAfterParsed=Object.assign({},useBeforeAllParsed);useAfterParsed.event={eventId:eventId,type:"cascade",eventName:useAfterParsed.eventName,nameSpace:useAfterParsed.nameSpace,isUseBeforeAll:!1,isUseBefore:!1,isUseAfter:!0,isUseAfterAll:!1};var normalListeners=void 0;normalListeners=nameSpace?root.listeners(nameSpace,eventName):root.listeners(eventName);var p=void 0;p=root._useBeforeAll._cascade(useBeforeAllParsed);var inlineOn={_before:root._useBefore,beforeParsed:useBeforeParsed,_after:root._useAfter,afterParsed:useAfterParsed};return p=p.then(function(result){return normalParsed.data=result,root._normal._cascade(normalParsed,inlineOn)}),p=p.then(afterAll),p.then(function(result){return clearTimeout(finished),result})},root.listeners=function(){for(var _len12=arguments.length,args=Array(_len12),_key12=0;_key12<_len12;_key12++)args[_key12]=arguments[_key12];return root._normal.listeners.apply(root._normal,args)},root.allListeners=function(){for(var _len13=arguments.length,args=Array(_len13),_key13=0;_key13<_len13;_key13++)args[_key13]=arguments[_key13];return[].concat(_toConsumableArray(root._useBeforeAll.listeners.apply(root._useBeforeAll,args)),_toConsumableArray(root._useBefore.listeners.apply(root._useBefore,args)),_toConsumableArray(root._normal.listeners.apply(root._normal,args)),_toConsumableArray(root._useAfter.listeners.apply(root._useAfter,args)),_toConsumableArray(root._useAfterAll.listeners.apply(root._useAfterAll,args)))},root.getNameSpaceListeners=function(){for(var _len14=arguments.length,args=Array(_len14),_key14=0;_key14<_len14;_key14++)args[_key14]=arguments[_key14];return root._normal.getNameSpaceListeners.apply(root._normal,args)},root.getAllNameSpaceListeners=function(){for(var _len15=arguments.length,args=Array(_len15),_key15=0;_key15<_len15;_key15++)args[_key15]=arguments[_key15];return[].concat(_toConsumableArray(root._useBeforeAll.getNameSpaceListeners.apply(root._useBeforeAll,args)),_toConsumableArray(root._useBefore.getNameSpaceListeners.apply(root._useBefore,args)),_toConsumableArray(root._normal.getNameSpaceListeners.apply(root._normal,args)),_toConsumableArray(root._useAfter.getNameSpaceListeners.apply(root._useAfter,args)),_toConsumableArray(root._useAfterAll.getNameSpaceListeners.apply(root._useAfterAll,args)))},root.removeNameSpaceListeners=function(){for(var _len16=arguments.length,args=Array(_len16),_key16=0;_key16<_len16;_key16++)args[_key16]=arguments[_key16];return root._normal.removeNameSpaceListeners.apply(root._normal,args)},root.removeAllNameSpaceListeners=function(){for(var _len17=arguments.length,args=Array(_len17),_key17=0;_key17<_len17;_key17++)args[_key17]=arguments[_key17];return root._normal.removeNameSpaceListeners.apply(root._normal,args)+root._useBeforeAll.removeNameSpaceListeners.apply(root._useBeforeAll,args)+root._useBefore.removeNameSpaceListeners.apply(root._useBefore,args)+root._useAfter.removeNameSpaceListeners.apply(root._useAfter,args)+root._useAfterAll.removeNameSpaceListeners.apply(root._useAfterAll,args)},root.wildcardMatchEventName=function(){for(var _len18=arguments.length,args=Array(_len18),_key18=0;_key18<_len18;_key18++)args[_key18]=arguments[_key18];return root._normal.wildcardMatchEventName.apply(root._normal,args)},root}function EventorConstructor(opts){var eventor=Eventor(opts);return eventor.before=Eventor(opts),eventor.after=eventor,eventor}var uid=function(){function random(count){if(isNode)return nodeRandom(count);var crypto=window.crypto||window.msCrypto;if(!crypto)throw new Error("Your browser does not support window.crypto.");return browserRandom(count)}function nodeRandom(count){var buf=crypto.randomBytes(count);return[].slice.call(buf)}function browserRandom(count){var nativeArr=new Uint8Array(count),crypto=window.crypto||window.msCrypto;return crypto.getRandomValues(nativeArr),[].slice.call(nativeArr)}function pad(num,size){var s="000000000"+num;return s.substr(s.length-size)}function nodePrint(){var os=require("os"),padding=2,pid=pad(process.pid.toString(36),padding),hostname=os.hostname(),length=hostname.length,hostId=pad(hostname.split("").reduce(function(prev,char){return+prev+char.charCodeAt(0)},+length+36).toString(36),padding);return pid+hostId}function browserPrint(){var i,count=0;for(i in window)count++;var globalCount=count.toString(36);return pad((navigator.mimeTypes.length+navigator.userAgent.length).toString(36)+globalCount,4)}function randomBlock(cryptoBytes){if(cryptoBytes){var randomNrs=random(4),r1=randomNrs[0].toString(16),r2=randomNrs[1].toString(16),r3=randomNrs[2].toString(16),r4=randomNrs[3].toString(16);return r1+r2+r3+r4}var rand=Math.floor(Math.random()*Math.pow(256,4)).toString(16);return pad(rand,8)}function safeCounter(){return c=c<discreteValues?c:0,c++,c-1}function _uid(){var cryptoBytes=!1,now=Date.now(),timestamp=now,random=randomBlock(cryptoBytes)+randomBlock(cryptoBytes),counter=pad(safeCounter().toString(16),4);return timestamp+"-"+random+"-"+fingerprint+"-"+counter}var isNode="undefined"!=typeof process&&"number"==typeof process.pid;if(isNode)var crypto=require("crypto");var fingerprint=isNode?nodePrint():browserPrint(),c=0,discreteValues=Math.pow(256,2);return _uid}(),EventorError=function EventorError(error,event){_classCallCheck(this,EventorError),this.error=error,this.event=event},EventorBasic=function(){function EventorBasic(opts){if(_classCallCheck(this,EventorBasic),this._listeners={},this._allListeners={},this._wildcardListeners={},this._allWildcardListeners=[],this.delimeter=".",this._shared=opts._shared,"function"==typeof opts.errorEventsErrorHandler?this._errorEventsErrorHandler=opts.errorEventsErrorHandler:this._errorEventsErrorHandler=function(){},this.root=opts.root,this.timeout=opts.timeout||6e4,"undefined"==typeof opts.promise?this.promise=Promise:this.promise=opts.promise,"undefined"==typeof opts.unique?this.unique=uid:this.unique=opts.unique,"string"==typeof opts.delimeter){if(opts.delimeter.length>1)throw new Error("Delimeter should be one character long.");this.delimeter=opts.delimeter}}return _createClass(EventorBasic,[{key:"_generateListenerId",value:function(){return++this._shared.lastId}},{key:"on",value:function(){for(var eventName="",callback=function(){},nameSpace="",position=void 0,emptyArgs=!1,_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];if(args.forEach(function(arg,index){"undefined"!=typeof arg&&null!=arg||(emptyArgs=index)}),emptyArgs!==!1)throw new TypeError("Undefined argument at position "+emptyArgs);if("string"!=typeof args[0]&&"RegExp"!=args[0].constructor.name)throw new TypeError("First argument should be string or RegExp in Eventor.on method");if("string"!=typeof args[0]&&"RegExp"!==args[0].constructor.name||"function"!=typeof args[1]){if("string"!=typeof args[0]||"string"!=typeof args[1]&&"RegExp"!==args[1].constructor.name||"function"!=typeof args[2])throw new TypeError("Invalid arguments inside 'on' method.");if(nameSpace=args[0],eventName=args[1],callback=args[2],"number"==typeof args[3])position=args[3];else if("undefined"!=typeof args[3])throw new TypeError("Fourth argument should be a number.")}else if(eventName=args[0],callback=args[1],"number"==typeof args[2])position=args[2];else if("undefined"!=typeof args[2])throw new TypeError("Third argument should be a number.");var wildcarded="RegExp"==eventName.constructor.name||eventName.indexOf("*")>=0,listenerId=this._generateListenerId(),wasPositioned="undefined"!=typeof position,originalPosition=Object.keys(this._allListeners).length;"undefined"==typeof position&&(position=originalPosition);var listener={id:listenerId,eventName:eventName,callback:callback,nameSpace:nameSpace,isWildcard:wildcarded,position:position,originalPosition:originalPosition,wasPositioned:wasPositioned};if(wildcarded){var regstr=eventName.toString();"undefined"==typeof this._wildcardListeners[regstr]&&(this._wildcardListeners[regstr]=[]),this._wildcardListeners[regstr].push(listener),this._allWildcardListeners.push(listener)}else"undefined"==typeof this._listeners[eventName]&&(this._listeners[eventName]=[]),this._listeners[eventName].push(listener);return this._allListeners[listenerId]=listener,listenerId}},{key:"removeListener",value:function(listenerId){var listener=this._allListeners[listenerId],eventName=listener.eventName;if(listener.isWildcard){var _pos=this._wildcardListeners[eventName].indexOf(listener);this._wildcardListeners[eventName].splice(_pos,1)}else{var pos=this._listeners[eventName].indexOf(listener);this._listeners[eventName].splice(pos,1)}delete this._allListeners[listenerId]}},{key:"off",value:function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return this.removeListener.apply(this,args)}},{key:"removeNameSpaceListeners",value:function(nameSpace){var _this=this,listeners=this.getNameSpaceListeners(nameSpace),ids=[];return listeners.forEach(function(listener){ids.push(listener.id)}),ids.forEach(function(id){_this.removeListener(id)}),ids.length}},{key:"wildcardMatchEventName",value:function(wildcard,eventName){if("string"==typeof wildcard){var str=wildcard.replace(/[^a-z0-9]{1}/gi,"\\$&").replace(/\\\*\\\*/gi,".*").replace(/\\\*/gi,"[^\\"+this.delimeter+"]*");str="^"+str+"$",wildcard=new RegExp(str)}return eventName.match(wildcard)}},{key:"_getListenersForEvent",value:function(eventName){var _this2=this;if(this._allWildcardListeners.length>0){var listeners=[];"undefined"!=typeof this._listeners[eventName]&&(listeners=copyArray(this._listeners[eventName]));var wildcarded=this._allWildcardListeners.filter(function(listener){return listener._tempMatches=_this2.wildcardMatchEventName(listener.eventName,eventName),null!=listener._tempMatches});return pushArray(wildcarded,listeners),listeners}return"undefined"!=typeof this._listeners[eventName]?this._listeners[eventName]:[]}},{key:"_getListenersForEventFromArray",value:function(eventName,listeners){var _this3=this,filtered=[];return filtered=listeners.filter(function(listener){return listener.isWildcard?(listener._tempMatches=_this3.wildcardMatchEventName(listener.eventName,eventName),null!=listener._tempMatches):listener.eventName===eventName})}},{key:"_sortListeners",value:function(listeners){var sorted=listeners.sort(function(a,b){if(a.position===b.position){if(a.wasPositioned&&b.wasPositioned)return b.id-a.id;if(a.wasPositioned||b.wasPositioned)return a.wasPositioned?-1:1;throw new Error("Both listeners have same position, but were not positioned manually (internal error).")}return a.position-b.position});return sorted}},{key:"listeners",value:function listeners(){var listeners=[];return 0===arguments.length?pushObjAsArray(this._allListeners,listeners):1==arguments.length?listeners=this._getListenersForEvent(arguments.length<=0?void 0:arguments[0]):2==arguments.length&&(listeners=this.getNameSpaceListeners(arguments.length<=0?void 0:arguments[0]),listeners=this._getListenersForEventFromArray(arguments.length<=1?void 0:arguments[1],listeners)),this._sortListeners(listeners)}},{key:"getNameSpaceListeners",value:function(nameSpace){var all=this.listeners(),result=all.filter(function(listener){return listener.nameSpace===nameSpace});return result}},{key:"_parseArguments",value:function(args){var result={};if(result.eventName="",result.data=void 0,result.nameSpace=void 0,"string"!=typeof args[0])return!1;if(2==args.length)result.eventName=args[0],result.data=args[1];else{if(3!=args.length)throw new Error("Arguments length is incorrect\n"+JSON.stringify(args));result.nameSpace=args[0],result.eventName=args[1],result.data=args[2]}return result}},{key:"_getListenersFromParsedArguments",value:function(parsedArgs){var listeners=[];return listeners="undefined"==typeof parsedArgs.nameSpace?this.listeners(parsedArgs.eventName):this.listeners(parsedArgs.nameSpace,parsedArgs.eventName)}},{key:"_handleError",value:function(errorObj){var _this4=this,handleItOutsideTry=function(e){_this4._errorEventsErrorHandler(e)};try{this.root.emit("error",errorObj).catch(function(errorObj){})}catch(e){handleItOutsideTry(e)}}},{key:"_emit",value:function(parsedArgs,inlineOn){var _this5=this,listeners=this._getListenersFromParsedArguments(parsedArgs);if(0==listeners.length)return this.promise.all([]);for(var results=[],len=listeners.length,i=-1,_loop=function(){var promise=void 0,promiseBefore=void 0,promiseAfter=void 0;if("undefined"!=typeof inlineOn){var parsed=Object.assign({},inlineOn.beforeParsed);parsed.event=Object.assign({},parsed.event),promiseBefore=inlineOn._before._cascade(parsed)}var listener=listeners[i],eventObj=Object.assign({},parsedArgs.event);eventObj.listener=listener,eventObj.matches=listener._tempMatches,delete listener._tempMatches;var normalOn=function(input){var promise=void 0;try{promise=listener.callback(input,eventObj),promise instanceof _this5.promise&&(promise=promise.catch(function(e){var errorObj=new EventorError(e,eventObj);return"error"!=parsedArgs.eventName?_this5._handleError(errorObj):_this5._errorEventsErrorHandler(e),_this5.promise.reject(errorObj)}))}catch(e){var errorObj=new EventorError(e,eventObj);"error"!=parsedArgs.eventName?_this5._handleError(errorObj):_this5._errorEventsErrorHandler(e),promise=_this5.promise.reject(errorObj)}return promise};promise="undefined"!=typeof promiseBefore?promiseBefore.then(normalOn):normalOn(parsedArgs.data),"undefined"!=typeof inlineOn?(promise instanceof _this5.promise?promiseAfter=promise.then(function(result){var parsed=Object.assign({},inlineOn.afterParsed);return parsed.data=result,parsed.event=Object.assign({},parsed.event),inlineOn._after._cascade(parsed)}):(inlineOn.afterParsed.data=promise,promiseAfter=inlineOn._after._cascade(inlineOn.afterParsed)),results.push(promiseAfter)):results.push(promise)};++i<len;)_loop();return this.promise.all(results)}},{key:"_validateArgs",value:function(args){var parsedArgs=this._parseArguments(args);return parsedArgs}},{key:"emit",value:function(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];var parsedArgs=this._validateArgs(args);return parsedArgs.event={type:"emit",eventName:parsedArgs.eventName,nameSpace:parsedArgs.nameSpace,isUseBeforeAll:parsedArgs.isUseBeforeAll,isUseBefore:parsedArgs.isUseBefore,isUseAfter:parsedArgs.isUseAfter,isUseAfterAll:parsedArgs.isUseAfterAll},this._emit(parsedArgs)}},{key:"_cascade",value:function(parsedArgs,inlineOn){var _this6=this,listeners=this._getListenersFromParsedArguments(parsedArgs),result=this.promise.resolve(parsedArgs.data);if(0==listeners.length)return result;for(var len=listeners.length,i=-1,_loop2=function(){var listener=listeners[i];"undefined"!=typeof inlineOn&&(result=result.then(function(result){var beforeParsed=Object.assign({},inlineOn.beforeParsed);return beforeParsed.data=result,beforeParsed.event=Object.assign({},beforeParsed.event),inlineOn._before._cascade(beforeParsed)})),result=result.then(function(currentData){var eventObj=Object.assign({},parsedArgs.event);eventObj.listener=listener,eventObj.matches=listener._tempMatches,delete listener._tempMatches;var promise=void 0;try{promise=listener.callback(currentData,eventObj),promise instanceof _this6.promise&&(promise=promise.catch(function(e){var errorObj=new EventorError(e,eventObj);return"error"!=parsedArgs.eventName?_this6._handleError(errorObj):_this6._errorEventsErrorHandler(e),_this6.promise.reject(errorObj)}))}catch(e){var errorObj=new EventorError(e,eventObj);return"error"!=parsedArgs.eventName?_this6._handleError(errorObj):_this6._errorEventsErrorHandler(e),_this6.promise.reject(errorObj)}return promise}),"undefined"!=typeof inlineOn&&(result=result.then(function(result){var afterParsed=Object.assign({},inlineOn.afterParsed);return afterParsed.data=result,afterParsed.event=Object.assign({},afterParsed.event),inlineOn._after._cascade(afterParsed)}))};++i<len;)_loop2();return result}},{key:"cascade",value:function(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];var parsedArgs=this._validateArgs(args);return parsedArgs.event={type:"cascade",eventName:parsedArgs.eventName,nameSpace:parsedArgs.nameSpace,isUseBeforeAll:parsedArgs.isUseBeforeAll,isUseBefore:parsedArgs.isUseBefore,isUseAfter:parsedArgs.isUseAfter,isUseAfterAll:parsedArgs.isUseAfterAll},this._cascade(parsedArgs)}}]),EventorBasic}();return EventorConstructor.prototype.Error=EventorError,EventorConstructor}();"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=Eventor),"undefined"!=typeof window&&(window.Eventor=Eventor);